# Модуль парсинга прогнозов

## Описание

Модуль для парсинга прогнозов с сайта https://bookmaker-ratings.ru/forecast_homepage/

## Установка зависимостей

```bash
cd backend
npm install
```

## Настройка

Создайте файл `.env` в директории `backend/`:

```env
DATABASE_URL="file:./dev.db"
SCRAPING_DELAY=3000
```

Где:
- `DATABASE_URL` - путь к базе данных SQLite
- `SCRAPING_DELAY` - задержка между запросами в миллисекундах (по умолчанию 3000)

## Использование

### CLI команда

Запуск парсинга вручную:

```bash
npm run scrape:forecasts
```

Или с использованием мок-данных (для тестирования):

```bash
USE_MOCK=true npm run scrape:forecasts
```

### API эндпоинт

Обновление прогнозов через API:

```bash
POST /api/forecasts/refresh
```

Ответ:
```json
{
  "success": true,
  "count": 10,
  "message": "Forecasts refreshed successfully"
}
```

### Автоматическое обновление

На фронтенде прогнозы автоматически обновляются, если прошло более 30 минут с последнего обновления.

## Структура данных

Каждый прогноз содержит:
- `id` - уникальный идентификатор (генерируется из title + date)
- `sport` - название спорта
- `tournament` - турнир/лига
- `match` - команда1 vs команда2
- `odds` - коэффициент (если есть)
- `expertName` - имя эксперта
- `expertAvatarUrl` - аватар эксперта
- `expertStatus` - статус ("эксперт" или "любитель")
- `winrate` - винрейт эксперта (60-85%, генерируется случайно)
- `prediction` - тип ставки
- `comment` - комментарий/анализ
- `fullText` - полный текст анализа
- `sourceUrl` - ссылка на источник
- `publishedAt` - дата публикации

## Логирование

Все ошибки парсинга логируются в:
- Консоль
- `logs/scraping.log`

## Примечания

- Парсер извлекает топ-10 свежих прогнозов
- Старые прогнозы удаляются перед добавлением новых
- Если парсинг не удался, используются мок-данные
- Если прогнозов меньше 10, они дополняются мок-данными

